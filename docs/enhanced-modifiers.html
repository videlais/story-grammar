<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Story Grammar - Enhanced Modifiers Demo</title>
    <style>
        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            max-width: 1200px;
            margin: 0 auto;
            padding: 20px;
            line-height: 1.6;
            background-color: #f8f9fa;
        }
        .container {
            background: white;
            padding: 30px;
            border-radius: 10px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
        }
        h1, h2 {
            color: #2c3e50;
            margin-bottom: 20px;
        }
        .demo-section {
            margin: 30px 0;
            padding: 20px;
            background: #f8f9fa;
            border-radius: 8px;
            border-left: 4px solid #007bff;
        }
        .input-group {
            margin: 15px 0;
        }
        label {
            display: block;
            margin-bottom: 5px;
            font-weight: 600;
            color: #495057;
        }
        input, select, textarea {
            width: 100%;
            padding: 10px;
            border: 1px solid #ced4da;
            border-radius: 5px;
            font-size: 14px;
        }
        button {
            background: #007bff;
            color: white;
            border: none;
            padding: 12px 24px;
            border-radius: 5px;
            cursor: pointer;
            font-size: 16px;
            margin: 10px 5px 10px 0;
        }
        button:hover {
            background: #0056b3;
        }
        .output {
            background: #e9ecef;
            border: 1px solid #ced4da;
            border-radius: 5px;
            padding: 15px;
            margin: 15px 0;
            min-height: 100px;
            white-space: pre-wrap;
            font-family: 'Courier New', monospace;
        }
        .stats {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 15px;
            margin: 20px 0;
        }
        .stat-card {
            background: #fff;
            padding: 15px;
            border-radius: 5px;
            border: 1px solid #dee2e6;
            text-align: center;
        }
        .stat-number {
            font-size: 24px;
            font-weight: bold;
            color: #007bff;
        }
        .stat-label {
            font-size: 12px;
            color: #6c757d;
            text-transform: uppercase;
        }
        .feature-list {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: 10px;
            margin: 20px 0;
        }
        .feature-item {
            padding: 10px;
            background: #e3f2fd;
            border-radius: 5px;
            border-left: 3px solid #2196f3;
        }
        .performance-info {
            background: #f0f8f0;
            border: 1px solid #c3e6c3;
            padding: 15px;
            border-radius: 5px;
            margin: 15px 0;
        }
    </style>
</head>
<body>
    <div class="container">
        <h1>üé≠ Story Grammar - Enhanced Modifiers Demo</h1>
        <p>Experience the power of enhanced text generation with comprehensive English language modifiers, performance monitoring, and advanced error handling.</p>

        <div class="demo-section">
            <h2>üé® Interactive Grammar Generator</h2>
            
            <div class="input-group">
                <label for="template">Grammar Template:</label>
                <textarea id="template" rows="3" placeholder="Enter your grammar template (use %variable% syntax)">I found a %item%. there are %quantity% %item% here. this is the %number% time! [emphasis]amazing[/emphasis] discovery.</textarea>
            </div>

            <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 20px;">
                <div class="input-group">
                    <label for="items">Items (comma-separated):</label>
                    <input type="text" id="items" placeholder="apple, elephant, umbrella" value="apple, elephant, umbrella, orange, igloo">
                </div>
                <div class="input-group">
                    <label for="quantities">Quantities (comma-separated):</label>
                    <input type="text" id="quantities" placeholder="many, three, several" value="many, three, several, five, two">
                </div>
            </div>

            <div class="input-group">
                <label for="numbers">Numbers (comma-separated):</label>
                <input type="text" id="numbers" placeholder="1, 2, 3, 21, 22" value="1, 2, 3, 11, 21, 22, 23, 101, 102, 103">
            </div>

            <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(200px, 1fr)); gap: 10px; margin: 15px 0;">
                <button onclick="generateSingle()">Generate Single</button>
                <button onclick="generateMultiple()">Generate 5 Variations</button>
                <button onclick="generateBatch()">Batch Generate</button>
                <button onclick="analyzePerformance()">Performance Test</button>
                <button onclick="toggleModifiers()">Toggle All Modifiers</button>
            </div>

            <div class="output" id="output">Click any button above to see results...</div>
        </div>

        <div class="demo-section">
            <h2>üìä Parser Statistics & Analysis</h2>
            <div class="stats" id="stats">
                <!-- Stats will be populated here -->
            </div>
            <div class="performance-info" id="performance">
                Performance metrics will appear here after running tests...
            </div>
        </div>

        <div class="demo-section">
            <h2>üîß Enhanced Features</h2>
            <div class="feature-list">
                <div class="feature-item">
                    <strong>Article Correction:</strong><br>
                    "a elephant" ‚Üí "an elephant"
                </div>
                <div class="feature-item">
                    <strong>Pluralization:</strong><br>
                    "many cat" ‚Üí "many cats"
                </div>
                <div class="feature-item">
                    <strong>Ordinal Numbers:</strong><br>
                    "1 place" ‚Üí "1st place"
                </div>
                <div class="feature-item">
                    <strong>Capitalization:</strong><br>
                    "hello. world" ‚Üí "hello. World"
                </div>
                <div class="feature-item">
                    <strong>Possessives:</strong><br>
                    "John possessive car" ‚Üí "John's car"
                </div>
                <div class="feature-item">
                    <strong>Verb Agreement:</strong><br>
                    "he are happy" ‚Üí "he is happy"
                </div>
                <div class="feature-item">
                    <strong>Emphasis Formatting:</strong><br>
                    "[bold]text[/bold]" ‚Üí "**text**"
                </div>
                <div class="feature-item">
                    <strong>Punctuation Cleanup:</strong><br>
                    "hello  ,  world" ‚Üí "hello, world"
                </div>
            </div>
        </div>
    </div>

    <script src="https://cdn.jsdelivr.net/gh/videlais/story-grammar@main/dist/story-grammar.bundle.js"></script>
    <script>
        // Initialize parser with enhanced features
        const parser = new StoryGrammar.Parser();
        let modifiersEnabled = false;

        function setupRules() {
            // Clear existing rules
            parser.clear();
            
            // Add rules based on current inputs
            const items = document.getElementById('items').value.split(',').map(s => s.trim()).filter(s => s);
            const quantities = document.getElementById('quantities').value.split(',').map(s => s.trim()).filter(s => s);
            const numbers = document.getElementById('numbers').value.split(',').map(s => s.trim()).filter(s => s);
            
            if (items.length) parser.addRule('item', items);
            if (quantities.length) parser.addRule('quantity', quantities);
            if (numbers.length) parser.addRule('number', numbers);
        }

        function toggleModifiers() {
            parser.clearModifiers();
            
            if (!modifiersEnabled) {
                parser.loadModifiers(StoryGrammar.AllEnglishModifiers);
                modifiersEnabled = true;
                updateOutput("All English modifiers enabled! ‚úÖ\\nTry generating text to see the enhanced formatting.");
            } else {
                modifiersEnabled = false;
                updateOutput("All modifiers disabled. ‚ùå\\nText will be generated without formatting enhancements.");
            }
            
            updateStats();
        }

        function generateSingle() {
            setupRules();
            if (modifiersEnabled) parser.loadModifiers(StoryGrammar.AllEnglishModifiers);
            
            const template = document.getElementById('template').value;
            try {
                const result = parser.parse(template);
                updateOutput(`Generated Text:\\n${result}`);
            } catch (error) {
                const helpfulError = parser.getHelpfulError(error, { text: template });
                updateOutput(`Error:\\n${helpfulError}`);
            }
            updateStats();
        }

        function generateMultiple() {
            setupRules();
            if (modifiersEnabled) parser.loadModifiers(StoryGrammar.AllEnglishModifiers);
            
            const template = document.getElementById('template').value;
            try {
                const variations = parser.generateVariations(template, 5);
                updateOutput(`5 Variations:\\n${variations.map((v, i) => `${i + 1}. ${v}`).join('\\n')}`);
            } catch (error) {
                const helpfulError = parser.getHelpfulError(error, { text: template });
                updateOutput(`Error:\\n${helpfulError}`);
            }
            updateStats();
        }

        function generateBatch() {
            setupRules();
            if (modifiersEnabled) parser.loadModifiers(StoryGrammar.AllEnglishModifiers);
            
            const templates = [
                'I found a %item%.',
                'There are %quantity% %item% here.',
                'This is the %number% time!'
            ];
            
            try {
                const results = parser.parseBatch(templates, true);
                updateOutput(`Batch Results (with context preservation):\\n${results.map((r, i) => `${i + 1}. ${r}`).join('\\n')}`);
            } catch (error) {
                updateOutput(`Error: ${error.message}`);
            }
            updateStats();
        }

        function analyzePerformance() {
            setupRules();
            if (modifiersEnabled) parser.loadModifiers(StoryGrammar.AllEnglishModifiers);
            
            const template = document.getElementById('template').value;
            
            try {
                // Single parse with timing
                const timedResult = parser.parseWithTiming(template);
                
                // Multiple parses for average
                const iterations = 100;
                const start = performance.now();
                for (let i = 0; i < iterations; i++) {
                    parser.parse(template);
                }
                const end = performance.now();
                const avgTime = (end - start) / iterations;
                
                // Rule analysis
                const analysis = parser.analyzeRules();
                const optimization = parser.optimize();
                
                const performanceInfo = `
Performance Analysis:
‚Ä¢ Single parse: ${timedResult.timing.totalMs.toFixed(3)}ms
  - Expansion: ${timedResult.timing.expansionMs.toFixed(3)}ms
  - Modifiers: ${timedResult.timing.modifierMs.toFixed(3)}ms
‚Ä¢ Average (${iterations} iterations): ${avgTime.toFixed(3)}ms
‚Ä¢ Total complexity: ${analysis.totalComplexity}
‚Ä¢ Average rule depth: ${analysis.averageDepth.toFixed(1)}

Rule Analysis:
‚Ä¢ Most complex rules: ${analysis.mostComplex.join(', ')}
‚Ä¢ Suggestions: ${analysis.suggestions.length ? analysis.suggestions.join(', ') : 'None'}

Optimization:
‚Ä¢ Status: ${optimization.optimized ? 'Optimized ‚úÖ' : 'Needs attention ‚ö†Ô∏è'}
${optimization.warnings.length ? '‚Ä¢ Warnings: ' + optimization.warnings.join(', ') : ''}
${optimization.suggestions.length ? '‚Ä¢ Suggestions: ' + optimization.suggestions.join(', ') : ''}
                `.trim();
                
                document.getElementById('performance').textContent = performanceInfo;
                updateOutput(`Performance test completed!\\nResult: ${timedResult.result}\\n\\nSee performance details below.`);
            } catch (error) {
                updateOutput(`Performance test error: ${error.message}`);
            }
            updateStats();
        }

        function updateOutput(text) {
            document.getElementById('output').textContent = text;
        }

        function updateStats() {
            const stats = parser.getStats();
            const validation = parser.validate();
            
            const statsHtml = `
                <div class="stat-card">
                    <div class="stat-number">${stats.totalRules}</div>
                    <div class="stat-label">Total Rules</div>
                </div>
                <div class="stat-card">
                    <div class="stat-number">${stats.totalModifiers}</div>
                    <div class="stat-label">Active Modifiers</div>
                </div>
                <div class="stat-card">
                    <div class="stat-number">${stats.rulesByType.static}</div>
                    <div class="stat-label">Static Rules</div>
                </div>
                <div class="stat-card">
                    <div class="stat-number">${stats.rulesByType.function}</div>
                    <div class="stat-label">Function Rules</div>
                </div>
                <div class="stat-card">
                    <div class="stat-number">${validation.isValid ? '‚úÖ' : '‚ùå'}</div>
                    <div class="stat-label">Validation Status</div>
                </div>
                <div class="stat-card">
                    <div class="stat-number">${stats.hasRandomSeed ? 'üé≤' : 'üéØ'}</div>
                    <div class="stat-label">${stats.hasRandomSeed ? 'Seeded' : 'Random'}</div>
                </div>
            `;
            
            document.getElementById('stats').innerHTML = statsHtml;
        }

        // Initialize on page load
        document.addEventListener('DOMContentLoaded', function() {
            updateStats();
            updateOutput('Welcome to the Enhanced Story Grammar Demo!\\n\\nThis demo showcases:\\n‚Ä¢ 8 comprehensive English modifiers\\n‚Ä¢ Performance monitoring\\n‚Ä¢ Rule analysis and optimization\\n‚Ä¢ Enhanced error handling\\n‚Ä¢ Batch processing capabilities\\n\\nClick "Toggle All Modifiers" to enable enhanced formatting, then try generating text!');
        });
    </script>
</body>
</html>