<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Weighted Rules Example - Story Grammar</title>
    <style>
        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            max-width: 900px;
            margin: 0 auto;
            padding: 20px;
            line-height: 1.6;
        }
        .container {
            background: #f8f9fa;
            border-radius: 12px;
            padding: 30px;
            box-shadow: 0 4px 12px rgba(0,0,0,0.1);
        }
        h1 {
            color: #2c3e50;
            text-align: center;
            margin-bottom: 30px;
        }
        .example-section {
            margin: 20px 0;
            padding: 15px;
            background: white;
            border-radius: 8px;
            border-left: 4px solid #e74c3c;
        }
        .weight-display {
            display: flex;
            gap: 10px;
            align-items: center;
            margin: 10px 0;
            flex-wrap: wrap;
        }
        .weight-item {
            background: #ecf0f1;
            padding: 5px 10px;
            border-radius: 4px;
            font-family: monospace;
            font-size: 14px;
        }
        .template {
            font-family: 'Courier New', monospace;
            background: #ecf0f1;
            padding: 8px;
            border-radius: 4px;
            margin: 8px 0;
        }
        .result {
            background: #ffe8e8;
            border: 1px solid #e74c3c;
            padding: 8px;
            border-radius: 4px;
            margin: 4px 0;
        }
        .controls {
            text-align: center;
            margin: 20px 0;
        }
        button {
            background: #e74c3c;
            color: white;
            border: none;
            padding: 12px 24px;
            border-radius: 6px;
            cursor: pointer;
            font-size: 16px;
            margin: 0 10px;
        }
        button:hover {
            background: #c0392b;
        }
        .stats {
            background: #e8f5e8;
            border: 1px solid #27ae60;
            padding: 15px;
            border-radius: 8px;
            margin: 15px 0;
        }
        .stats-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 15px;
        }
        .stat-item {
            background: white;
            padding: 10px;
            border-radius: 6px;
            text-align: center;
        }
        .stat-value {
            font-size: 24px;
            font-weight: bold;
            color: #2c3e50;
        }
        .stat-label {
            font-size: 12px;
            color: #7f8c8d;
        }
        .comparison {
            background: #fff3cd;
            border: 1px solid #ffc107;
            padding: 15px;
            border-radius: 8px;
            margin: 15px 0;
        }
    </style>
</head>
<body>
    <div class="container">
        <h1>‚öñÔ∏è Weighted Rules Example</h1>
        <p>This example demonstrates <strong>weighted probability rules</strong> in Story Grammar. Unlike equal-probability rules, weighted rules allow you to specify how likely each option should be selected.</p>
        
        <div class="example-section">
            <h3>Weighted vs Equal Probability</h3>
            <p><strong>Equal Probability:</strong> <code>addRule('color', ['red', 'green', 'blue'])</code> - Each has 33.33% chance</p>
            <p><strong>Weighted:</strong> <code>addWeightedRule('color', ['red', 'green', 'blue'], [0.5, 0.25, 0.25])</code></p>
            <div class="weight-display">
                <div class="weight-item">red: 50%</div>
                <div class="weight-item">green: 25%</div>
                <div class="weight-item">blue: 25%</div>
            </div>
        </div>

        <div class="example-section">
            <h3>Live Examples</h3>
            <div id="examples"></div>
        </div>

        <div class="controls">
            <button onclick="generateExamples()">üé≤ Generate Examples</button>
            <button onclick="runStatistics()">üìä Run 1000 Sample Test</button>
            <button onclick="showComparison()">‚öñÔ∏è Compare Weighted vs Equal</button>
        </div>

        <div id="stats-section" class="stats" style="display: none;">
            <h3>Statistical Results (1000 samples)</h3>
            <div class="stats-grid" id="stats-grid"></div>
        </div>

        <div id="comparison-section" class="comparison" style="display: none;">
            <h3>Weighted vs Equal Probability Comparison</h3>
            <p>Both rules generate the same content, but with different probabilities:</p>
            <div id="comparison-results"></div>
        </div>
    </div>

    <script src="https://cdn.jsdelivr.net/npm/story-grammar@latest/dist/bundle.min.js"></script>
    <script>
        const parser = new StoryGrammar.Parser();

        // Add static rules for context
        parser.addRule('character', ['brave knight', 'wise wizard', 'cunning rogue', 'noble paladin']);
        parser.addRule('location', ['ancient forest', 'mystical cave', 'royal castle', 'haunted tower']);
        parser.addRule('action', ['discovers', 'encounters', 'battles', 'investigates']);

        // Add weighted rules with realistic distributions
        parser.addWeightedRule('rarity', 
            ['common', 'uncommon', 'rare', 'epic', 'legendary'], 
            [0.50, 0.30, 0.15, 0.04, 0.01]
        );

        parser.addWeightedRule('treasure', 
            ['coins', 'jewelry', 'weapon', 'armor', 'artifact'], 
            [0.40, 0.25, 0.20, 0.10, 0.05]
        );

        parser.addWeightedRule('weather', 
            ['sunny', 'cloudy', 'rainy', 'foggy', 'stormy'], 
            [0.35, 0.30, 0.20, 0.10, 0.05]
        );

        // Equal probability rule for comparison
        parser.addRule('weather_equal', ['sunny', 'cloudy', 'rainy', 'foggy', 'stormy']);

        const templates = [
            'A %character% finds %rarity% %treasure% in the %location%.',
            'The %weather% weather makes the %location% feel mysterious.',
            'During %weather% weather, a %character% %action% %rarity% treasures.'
        ];

        const weightInfo = {
            rarity: { values: ['common', 'uncommon', 'rare', 'epic', 'legendary'], weights: [50, 30, 15, 4, 1] },
            treasure: { values: ['coins', 'jewelry', 'weapon', 'armor', 'artifact'], weights: [40, 25, 20, 10, 5] },
            weather: { values: ['sunny', 'cloudy', 'rainy', 'foggy', 'stormy'], weights: [35, 30, 20, 10, 5] }
        };

        function generateExamples() {
            const examplesDiv = document.getElementById('examples');
            examplesDiv.innerHTML = '';

            Object.entries(weightInfo).forEach(([ruleName, info]) => {
                const ruleDiv = document.createElement('div');
                ruleDiv.innerHTML = `<h4>${ruleName.charAt(0).toUpperCase() + ruleName.slice(1)} Rule Weights:</h4>`;
                
                const weightDisplay = document.createElement('div');
                weightDisplay.className = 'weight-display';
                info.values.forEach((value, i) => {
                    const item = document.createElement('div');
                    item.className = 'weight-item';
                    item.textContent = `${value}: ${info.weights[i]}%`;
                    weightDisplay.appendChild(item);
                });
                ruleDiv.appendChild(weightDisplay);
                examplesDiv.appendChild(ruleDiv);
            });

            templates.forEach((template, index) => {
                const templateDiv = document.createElement('div');
                templateDiv.innerHTML = `<h4>Example ${index + 1}</h4><div class="template">${template}</div>`;

                for (let i = 0; i < 4; i++) {
                    const result = parser.parse(template);
                    const resultDiv = document.createElement('div');
                    resultDiv.className = 'result';
                    resultDiv.textContent = `‚Üí ${result}`;
                    templateDiv.appendChild(resultDiv);
                }

                examplesDiv.appendChild(templateDiv);
            });
        }

        function runStatistics() {
            const samples = 1000;
            const counts = {
                rarity: { common: 0, uncommon: 0, rare: 0, epic: 0, legendary: 0 },
                treasure: { coins: 0, jewelry: 0, weapon: 0, armor: 0, artifact: 0 },
                weather: { sunny: 0, cloudy: 0, rainy: 0, foggy: 0, stormy: 0 }
            };

            // Run sampling
            for (let i = 0; i < samples; i++) {
                Object.keys(counts).forEach(ruleName => {
                    const result = parser.parse(`%${ruleName}%`);
                    if (counts[ruleName][result] !== undefined) {
                        counts[ruleName][result]++;
                    }
                });
            }

            // Display results
            const statsSection = document.getElementById('stats-section');
            const statsGrid = document.getElementById('stats-grid');
            statsGrid.innerHTML = '';

            Object.entries(counts).forEach(([ruleName, ruleCounts]) => {
                const info = weightInfo[ruleName];
                info.values.forEach((value, i) => {
                    const actual = (ruleCounts[value] / samples * 100).toFixed(1);
                    const expected = info.weights[i];
                    const diff = Math.abs(actual - expected).toFixed(1);

                    const statItem = document.createElement('div');
                    statItem.className = 'stat-item';
                    statItem.innerHTML = `
                        <div class="stat-value">${actual}%</div>
                        <div class="stat-label">${value} (${ruleName})</div>
                        <div class="stat-label">Expected: ${expected}%</div>
                        <div class="stat-label">Diff: ¬±${diff}%</div>
                    `;
                    statsGrid.appendChild(statItem);
                });
            });

            statsSection.style.display = 'block';
        }

        function showComparison() {
            const comparisonSection = document.getElementById('comparison-section');
            const comparisonResults = document.getElementById('comparison-results');
            
            comparisonResults.innerHTML = `
                <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 20px; margin-top: 15px;">
                    <div>
                        <h4>Weighted Weather (Realistic)</h4>
                        <div class="weight-display">
                            <div class="weight-item">sunny: 35%</div>
                            <div class="weight-item">cloudy: 30%</div>
                            <div class="weight-item">rainy: 20%</div>
                            <div class="weight-item">foggy: 10%</div>
                            <div class="weight-item">stormy: 5%</div>
                        </div>
                        <div id="weighted-results"></div>
                    </div>
                    <div>
                        <h4>Equal Probability Weather</h4>
                        <div class="weight-display">
                            <div class="weight-item">Each: 20%</div>
                        </div>
                        <div id="equal-results"></div>
                    </div>
                </div>
            `;

            const weightedResults = document.getElementById('weighted-results');
            const equalResults = document.getElementById('equal-results');

            for (let i = 0; i < 5; i++) {
                const weighted = parser.parse('%weather%');
                const equal = parser.parse('%weather_equal%');
                
                weightedResults.innerHTML += `<div class="result">‚Üí ${weighted}</div>`;
                equalResults.innerHTML += `<div class="result">‚Üí ${equal}</div>`;
            }

            comparisonSection.style.display = 'block';
        }

        // Generate initial examples
        generateExamples();
    </script>
</body>
</html>