<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Advanced Rules Showcase - Story Grammar</title>
    <style>
        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            max-width: 800px;
            margin: 0 auto;
            padding: 20px;
            line-height: 1.6;
        }
        .container {
            background: #f8f9fa;
            border-radius: 12px;
            padding: 30px;
            box-shadow: 0 4px 12px rgba(0,0,0,0.1);
        }
        h1 {
            color: #2c3e50;
            text-align: center;
            margin-bottom: 30px;
        }
        .example-section {
            margin: 20px 0;
            padding: 15px;
            background: white;
            border-radius: 8px;
            border-left: 4px solid #3498db;
        }
        .template {
            font-family: 'Courier New', monospace;
            background: #ecf0f1;
            padding: 8px;
            border-radius: 4px;
            margin: 8px 0;
        }
        .result {
            background: #e8f5e8;
            border: 1px solid #27ae60;
            padding: 8px;
            border-radius: 4px;
            margin: 4px 0;
        }
        .controls {
            text-align: center;
            margin: 20px 0;
        }
        button {
            background: #3498db;
            color: white;
            border: none;
            padding: 12px 24px;
            border-radius: 6px;
            cursor: pointer;
            font-size: 16px;
            margin: 0 10px;
        }
        button:hover {
            background: #2980b9;
        }
        .code-block {
            background: #2c3e50;
            color: #ecf0f1;
            padding: 15px;
            border-radius: 8px;
            font-family: 'Courier New', monospace;
            font-size: 14px;
            overflow-x: auto;
            margin: 15px 0;
        }
    </style>
</head>
<body>
    <div class="container">
        <h1>üé≤ Advanced Rules Showcase</h1>
        <p>This example demonstrates <strong>all 8 rule types</strong> available in Story Grammar: Static, Function, Weighted, Conditional, Sequential, Range, Template, and Reference rules working together to create dynamic, context-aware narratives.</p>
        
        <div class="example-section">
            <h3>Rule Type Overview</h3>
            <p><strong>Static:</strong> <code>weather: ['sunny', 'rainy', 'cloudy']</code></p>
            <p><strong>Function:</strong> <code>randomNumber: () => [Math.floor(Math.random() * 100).toString()]</code></p>
            <p><strong>Weighted:</strong> <code>rarity: ['common', 'rare', 'legendary'], weights: [0.7, 0.25, 0.05]</code></p>
            <p><strong>Conditional:</strong> <code>context-aware selection based on previously generated values</code></p>
            <p><strong>Sequential:</strong> <code>cycles through values in order</code></p>
            <p><strong>Range:</strong> <code>generates numbers between min and max</code></p>
            <p><strong>Template:</strong> <code>structured combinations with slots</code></p>
            <p><strong>Reference:</strong> <code>reuses previously generated values</code></p>
        </div>

        <div class="example-section">
            <h3>Live Examples</h3>
            <div id="examples"></div>
        </div>

        <div class="controls">
            <button onclick="generateExamples()">üé≤ Generate New Examples</button>
            <button onclick="resetSequential()">üîÑ Reset Sequential Rules</button>
            <button onclick="showCode()">üìù Show Code</button>
        </div>

        <div id="code-section" style="display: none;">
            <h3>Implementation Code</h3>
            <div class="code-block">
// Create parser with all 8 rule types
const parser = new Parser();

// 1. Static Rules - Fixed arrays
parser.addRule('class', ['Warrior', 'Mage', 'Rogue']);

// 2. Function Rules - Dynamic generation  
parser.addFunctionRule('timestamp', () => [new Date().toLocaleTimeString()]);

// 3. Weighted Rules - Probability-based
parser.addWeightedRule('rarity', ['common', 'rare'], [0.8, 0.2]);

// 4. Conditional Rules - Context-aware
parser.addConditionalRule('name', (context) => {
    const cls = context.get('class');
    return cls === 'Mage' ? 'Gandalf' : 'Conan';
});

// 5. Sequential Rules - Ordered cycling
parser.addSequentialRule('chapter', ['I', 'II', 'III']);

// 6. Range Rules - Numeric ranges\nparser.addRangeRule('level', { min: 1, max: 20, type: 'integer' });

// 7. Template Rules - Structured combinations
parser.addTemplateRule('intro', '{name} the {class}', ['name', 'class']);

// 8. Reference Rules - Reuse values
// References use @ syntax: parser.parse('@character appears');

// Generate: "Gandalf the Mage appears in Chapter I"
const result = parser.parse('%@character% appears in Chapter %chapter%');
            </div>
        </div>
    </div>

    <script src="../dist/story-grammar.bundle.js"></script>
    <script>
        const parser = new StoryGrammar.Parser();

        // 1. Static Rules - Fixed arrays
        parser.addRule('character_class', ['Warrior', 'Mage', 'Rogue', 'Cleric']);
        parser.addRule('location', ['enchanted forest', 'ancient castle', 'bustling tavern', 'misty mountain']);
        parser.addRule('action', ['discovers', 'encounters', 'searches for', 'battles']);

        // 2. Function Rules - Dynamic generation
        parser.addFunctionRule('timestamp', () => {
            return [new Date().toLocaleTimeString()];
        });

        parser.addFunctionRule('weather_condition', () => {
            const conditions = ['sunny', 'rainy', 'foggy', 'stormy'];
            const temp = Math.floor(Math.random() * 40) + 32; // 32-72¬∞F
            const condition = conditions[Math.floor(Math.random() * conditions.length)];
            return [`${condition} (${temp}¬∞F)`];
        });

        // 3. Weighted Rules - Probability-based selection
        parser.addWeightedRule('item_rarity', 
            ['common', 'uncommon', 'rare', 'legendary'], 
            [0.6, 0.25, 0.12, 0.03] // 60%, 25%, 12%, 3%
        );

        parser.addWeightedRule('encounter_type',
            ['peaceful', 'challenging', 'dangerous'],
            [0.5, 0.35, 0.15]
        );

        // 4. Range Rules - Numeric ranges
        parser.addRangeRule('level', { min: 1, max: 20, type: 'integer' });      // Integer levels 1-20
        parser.addRangeRule('gold', { min: 10, max: 1000, type: 'integer' });    // Gold pieces
        parser.addRangeRule('health_percent', { min: 0.1, max: 1.0, type: 'float' }); // Health as decimal

        // 5. Sequential Rules - Ordered cycling
        parser.addSequentialRule('chapter', ['Prologue', 'Chapter I', 'Chapter II', 'Chapter III', 'Epilogue']);
        parser.addSequentialRule('phase', ['Dawn', 'Morning', 'Noon', 'Evening', 'Night']);

        // 6. Conditional Rules - Context-aware selection
        parser.addConditionalRule('character_name', (context) => {
            const charClass = context.get('character_class');
            const names = {
                'Warrior': ['Thorgar', 'Brianna', 'Marcus'],
                'Mage': ['Zephyr', 'Luna', 'Arcturus'],
                'Rogue': ['Shade', 'Whisper', 'Nyx'],
                'Cleric': ['Aurelia', 'Benedict', 'Seraphina']
            };
            const classNames = names[charClass] || ['Unknown'];
            return classNames[Math.floor(Math.random() * classNames.length)];
        });

        parser.addConditionalRule('appropriate_weapon', (context) => {
            const charClass = context.get('character_class');
            const weapons = {
                'Warrior': 'sword and shield',
                'Mage': 'magical staff',
                'Rogue': 'twin daggers',
                'Cleric': 'blessed mace'
            };
            return weapons[charClass] || 'bare hands';
        });

        // 7. Template Rules - Structured combinations
        parser.addTemplateRule('character_intro',
            '{name} the {class} (Level {level}) wields {weapon}',
            ['name', 'class', 'level', 'weapon']
        );

        parser.addTemplateRule('adventure_setup',
            'In {chapter}, during the {phase} in the {location}, {character} {action} a {rarity} treasure worth {gold} gold.',
            ['chapter', 'phase', 'location', 'character', 'action', 'rarity', 'gold']
        );

        // 8. Reference Rules - Use @ syntax in templates
        // References are accessed with @name syntax: '%@name% attacks with %@weapon%'

        // Templates showcasing all rule types
        const templates = [
            'üé≠ Character: %character_intro%',
            'üåç Adventure: %adventure_setup%',
            '‚öîÔ∏è Combat: %@name% attacks with %@weapon%! (Health: %health_percent%)',
            'üé≤ Encounter: %encounter_type% encounter at %timestamp% - Weather: %weather_condition%',
            'üìñ Story: %chapter% begins at %phase% when %@character% finds %item_rarity% loot!'
        ];

        function generateExamples() {
            const examplesDiv = document.getElementById('examples');
            examplesDiv.innerHTML = '';

            templates.forEach((template, index) => {
                const templateDiv = document.createElement('div');
                templateDiv.innerHTML = `
                    <h4>Example ${index + 1}</h4>
                    <div class="template">Template: ${template}</div>
                `;

                // Generate 3 variations to show randomness
                for (let i = 0; i < 3; i++) {
                    const result = parser.parse(template);
                    const resultDiv = document.createElement('div');
                    resultDiv.className = 'result';
                    resultDiv.textContent = `‚Üí ${result}`;
                    templateDiv.appendChild(resultDiv);
                }

                examplesDiv.appendChild(templateDiv);
            });
        }

        function resetSequential() {
            parser.resetSequentialRule('chapter');
            parser.resetSequentialRule('phase');
            alert('Sequential rules reset! Next generation will start from the beginning of sequences.');
        }

        function showCode() {
            const codeSection = document.getElementById('code-section');
            codeSection.style.display = codeSection.style.display === 'none' ? 'block' : 'none';
        }

        // Generate initial examples
        generateExamples();
    </script>
</body>
</html>