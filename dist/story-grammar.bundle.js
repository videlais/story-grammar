/*! For license information please see story-grammar.bundle.js.LICENSE.txt */
!function(e,r){"object"==typeof exports&&"object"==typeof module?module.exports=r():"function"==typeof define&&define.amd?define([],r):"object"==typeof exports?exports.StoryGrammar=r():e.StoryGrammar=r()}(this,()=>(()=>{"use strict";var e={"./src/Parser.ts":(e,r)=>{Object.defineProperty(r,"__esModule",{value:!0}),r.Parser=void 0,r.Parser=class{constructor(){this.grammar={},this.modifiers=new Map,this.variablePattern=/%([^%]+)%/g,this.maxDepth=100}addRule(e,r){if(!e||"string"!=typeof e)throw new Error("Key must be a non-empty string");if(!Array.isArray(r))throw new Error("Values must be an array");this.grammar[e]=[...r]}addRules(e){for(const[r,t]of Object.entries(e))this.addRule(r,t)}addModifier(e){var r;if(!e||"object"!=typeof e)throw new Error("Modifier must be an object");if(!e.name||"string"!=typeof e.name)throw new Error("Modifier must have a name");if("function"!=typeof e.condition)throw new Error("Modifier must have a condition function");if("function"!=typeof e.transform)throw new Error("Modifier must have a transform function");this.modifiers.set(e.name,Object.assign(Object.assign({},e),{priority:null!==(r=e.priority)&&void 0!==r?r:0}))}removeModifier(e){return this.modifiers.delete(e)}hasModifier(e){return this.modifiers.has(e)}getModifiers(){return Array.from(this.modifiers.values()).sort((e,r)=>{var t,i;return(null!==(t=r.priority)&&void 0!==t?t:0)-(null!==(i=e.priority)&&void 0!==i?i:0)})}addEnglishArticleModifier(){this.addModifier({name:"englishArticles",condition:e=>/\ba\s+[aeiouAEIOU]/.test(e),transform:e=>e.replace(/\ba(\s+)([aeiouAEIOU][a-z]*)/gi,"an$1$2"),priority:10})}addEnglishPluralizationModifier(){this.addModifier({name:"englishPluralization",condition:e=>/\b(many|several|multiple|some|few|\d*[2-9]\d*|\d+[02-9])\s+[a-zA-Z]+/i.test(e)||/\b(two|three|four|five|six|seven|eight|nine|ten)\s+[a-zA-Z]+/i.test(e),transform:e=>{const r={child:"children",person:"people",man:"men",woman:"women",mouse:"mice",foot:"feet",tooth:"teeth",goose:"geese",ox:"oxen",sheep:"sheep",deer:"deer",fish:"fish"};return e.replace(/\b(many|several|multiple|some|few|\d*[2-9]\d*|\d+[02-9]|two|three|four|five|six|seven|eight|nine|ten)\s+([a-zA-Z]+)\b/gi,(e,t,i)=>{const s=i.toLowerCase();if(r[s])return`${t} ${r[s]}`;let a=i;return a=/[sxz]$|[sc]h$/.test(s)?i+"es":/[bcdfghjklmnpqrstvwxz]y$/i.test(i)?i.slice(0,-1)+"ies":/fe?$/i.test(i)?i.replace(/fe?$/i,"ves"):/[bcdfghjklmnpqrstvwxz]o$/i.test(i)?["photo","piano","halo","disco"].includes(s)?i+"s":i+"es":i+"s",`${t} ${a}`})},priority:9})}addEnglishOrdinalModifier(){this.addModifier({name:"englishOrdinals",condition:e=>/\b\d+\b/.test(e),transform:e=>e.replace(/\b(\d+)\b/g,(e,r)=>{const t=parseInt(r,10),i=t%100;if(11===i||12===i||13===i)return r+"th";switch(t%10){case 1:return r+"st";case 2:return r+"nd";case 3:return r+"rd";default:return r+"th"}}),priority:8})}getGrammar(){const e={};for(const[r,t]of Object.entries(this.grammar))e[r]=[...t];return e}parse(e){if("string"!=typeof e)throw new Error("Text must be a string");const r=this.expandVariables(e,0);return this.applyModifiers(r,{originalText:e})}expandVariables(e,r){if(r>=this.maxDepth)throw new Error("Maximum recursion depth exceeded. Check for circular references in grammar.");return this.variablePattern.lastIndex=0,e.replace(this.variablePattern,(e,t)=>{const i=this.grammar[t];if(!i||0===i.length)return e;const s=this.getRandomValue(i);return this.expandVariables(s,r+1)})}applyModifiers(e,r){let t=e;const i=this.getModifiers();for(const e of i)e.condition(t,r)&&(t=e.transform(t,r));return t}getRandomValue(e){return e[Math.floor(Math.random()*e.length)]}hasRule(e){return e in this.grammar}removeRule(e){return!!this.hasRule(e)&&(delete this.grammar[e],!0)}clear(){this.grammar={}}clearModifiers(){this.modifiers.clear()}clearAll(){this.clear(),this.clearModifiers()}findVariables(e){const r=new Set;let t;for(this.variablePattern.lastIndex=0;null!==(t=this.variablePattern.exec(e));)r.add(t[1]);return Array.from(r)}validate(){const e=new Set,r=new Set;for(const[t,i]of Object.entries(this.grammar))for(const s of i){const i=this.findVariables(s);for(const s of i)this.hasRule(s)||e.add(s),s===t&&r.add(t)}return{isValid:0===e.size&&0===r.size,missingRules:Array.from(e),circularReferences:Array.from(r)}}setMaxDepth(e){if(e<1)throw new Error("Max depth must be at least 1");this.maxDepth=e}getMaxDepth(){return this.maxDepth}}}},r={};function t(i){var s=r[i];if(void 0!==s)return s.exports;var a=r[i]={exports:{}};return e[i](a,a.exports,t),a.exports}var i={};return(()=>{var e=i;Object.defineProperty(e,"__esModule",{value:!0}),e.StoryGrammar=e.Parser=void 0;var r=t("./src/Parser.ts");Object.defineProperty(e,"Parser",{enumerable:!0,get:function(){return r.Parser}});var s=t("./src/Parser.ts");Object.defineProperty(e,"StoryGrammar",{enumerable:!0,get:function(){return s.Parser}})})(),i})());
//# sourceMappingURL=story-grammar.bundle.js.map